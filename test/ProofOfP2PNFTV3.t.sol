// SPDX-License-Identifier: MIT
pragma solidity ^0.8.13;

import { Test, console2 } from "forge-std/Test.sol";
import { IAccountRegistry } from "../src/interfaces/IAccountRegistry.sol";
import { MockAccountRegistry } from "../src/mocks/MockAccountRegistry.sol";
import { ProofOfP2PNFTV3 } from "../src/ProofOfP2PNFTV3.sol";

contract ProofOfP2PNFTV3Test is Test {
    ProofOfP2PNFTV3 public proofOfP2PNFTV3;
    MockAccountRegistry public accountRegistry;

    function setUp() public {
        accountRegistry = new MockAccountRegistry();

        // Register user 0x1
        accountRegistry.setAccountId(
            address(1),
            bytes32(0x0741728e3aae72eda484e8ccbf00f843c38eae9c399b9bd7fb2b5ee7a055b6bf)
        );

        proofOfP2PNFTV3 = new ProofOfP2PNFTV3(
            accountRegistry,
            "Proof of Revolut",
            "PoRevolut",
            "Revolut",
            "001489",
            "012169",
            "C8102E",
            "FFDD00"
        );
    }
    
    function test_Mint() public {
        uint256 prevMinted = proofOfP2PNFTV3.getTokenId(address(1));
        assertEq(prevMinted, 0);

        vm.startPrank(address(1));
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();
        
        uint256 tokenId = proofOfP2PNFTV3.currentTokenId();
        assertEq(tokenId, 1);

        address owner = proofOfP2PNFTV3.ownerOf(tokenId);
        assertEq(owner, address(1));

        uint256 balance = proofOfP2PNFTV3.balanceOf(address(1));
        assertEq(balance, 1);

        uint256 currMinted = proofOfP2PNFTV3.getTokenId(address(1));
        assertEq(currMinted, 1);

        string memory tokenURI = proofOfP2PNFTV3.tokenURI(tokenId);
        string memory expectedTokenURI = "data:application/json;base64,eyJuYW1lIjoiUHJvb2Ygb2YgUmV2b2x1dCIsICJkZXNjcmlwdGlvbiI6IlRoaXMgc291bGJvdW5kIE5GVCByZXByZXNlbnRzIHByb29mIHRoYXQgeW91IGFyZSBhIHVuaXF1ZSBSZXZvbHV0IHVzZXIuIE1pbnQgdGhpcyBieSBnZW5lcmF0aW5nIGEgemVybyBrbm93bGVkZ2UgcHJvb2Ygb2YgYSBwYXltZW50IGNvbmZpcm1hdGlvbiBlbWFpbC4gWW91ciBpZGVudGlmaWVyIGlzIGhhc2hlZCwgc28gbm8gb25lIGtub3dzIHdobyB5b3UgYXJlIC0tIG9ubHkgdGhhdCB5b3UgYXJlIGFuIHVzZXIhXG5cbkhhc2hlZCBJRDogMHgwNzQxNzI4ZTNhYWU3MmVkYTQ4NGU4Y2NiZjAwZjg0M2MzOGVhZTljMzk5YjliZDdmYjJiNWVlN2EwNTViNmJmXG5cbiIsICJpbWFnZSI6ICJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlNamt3SWlCb1pXbG5hSFE5SWpReU1DSWdkbWxsZDBKdmVEMGlNQ0F3SURJNU1DQTBNakFpSUhodGJHNXpQU0pvZEhSd09pOHZkM2QzTG5jekxtOXlaeTh5TURBd0wzTjJaeUlnZUcxc2JuTTZlR3hwYm1zOUoyaDBkSEE2THk5M2QzY3Vkek11YjNKbkx6RTVPVGt2ZUd4cGJtc25QanhrWldaelBqeG1hV3gwWlhJZ2FXUTlJbVl4SWo0OFptVkpiV0ZuWlNCeVpYTjFiSFE5SW5Bd0lpQjRiR2x1YXpwb2NtVm1QU0prWVhSaE9tbHRZV2RsTDNOMlp5dDRiV3c3WW1GelpUWTBMRkJJVGpKYWVVSXpZVmRTTUdGRU1HNU5hbXQzU25sQ2IxcFhiRzVoU0ZFNVNucFJlVTFEWTJka2JXeHNaREJLZG1WRU1HNU5RMEYzU1VSSk5VMURRVEJOYWtGdVNVaG9kR0pITlhwUVUyUnZaRWhTZDA5cE9IWmtNMlF6VEc1amVreHRPWGxhZVRoNVRVUkJkMHd6VGpKYWVXTXJVRWhLYkZrelVXZGtNbXhyWkVkbk9VcDZTVFZOU0VJMFNubENiMXBYYkc1aFNGRTVTbnBSZVUxSVFqUktlVUp0WVZkNGMxQlRZMnBOUkVGNFRrUm5OVXA1T0N0UVF6bDZaRzFqS3lJdlBqeG1aVWx0WVdkbElISmxjM1ZzZEQwaWNERWlJSGhzYVc1ck9taHlaV1k5SW1SaGRHRTZhVzFoWjJVdmMzWm5LM2h0YkR0aVlYTmxOalFzVUVoT01scDVRak5oVjFJd1lVUXdiazFxYTNkS2VVSnZXbGRzYm1GSVVUbEtlbEY1VFVOaloyUnRiR3hrTUVwMlpVUXdiazFEUVhkSlJFazFUVU5CTUUxcVFXNUpTR2gwWWtjMWVsQlRaRzlrU0ZKM1QyazRkbVF6WkROTWJtTjZURzA1ZVZwNU9IbE5SRUYzVEROT01scDVZeXRRUjA1d1kyMU9jMXBUUW1wbFJEQnVUVlJCZVVwNVFtcGxWREJ1VFZSQmQwcDVRbmxRVTJONFRXcENkMlZEWTJkYWJXeHpZa1F3YmtsNlFYaE5ha1V5VDFOamRsQnFkM1pqTTFwdVVHYzlQU0l2UGp4bVpVbHRZV2RsSUhKbGMzVnNkRDBpY0RJaUlIaHNhVzVyT21oeVpXWTlJbVJoZEdFNmFXMWhaMlV2YzNabkszaHRiRHRpWVhObE5qUXNVRWhPTWxwNVFqTmhWMUl3WVVRd2JrMXFhM2RLZVVKdldsZHNibUZJVVRsS2VsRjVUVU5qWjJSdGJHeGtNRXAyWlVRd2JrMURRWGRKUkVrMVRVTkJNRTFxUVc1SlNHaDBZa2MxZWxCVFpHOWtTRkozVDJrNGRtUXpaRE5NYm1ONlRHMDVlVnA1T0hsTlJFRjNURE5PTWxwNVl5dFFSMDV3WTIxT2MxcFRRbXBsUkRCdVRXcFJOVXA1UW1wbFZEQnVUVlJCZDBwNVFubFFVMk40VFdwQ2QyVkRZMmRhYld4ellrUXdia2t3VFRSTlZFRjVVbE5qZGxCcWQzWmpNMXB1VUdjOVBTSWdMejQ4Wm1WSmJXRm5aU0J5WlhOMWJIUTlJbkF6SWlCNGJHbHVhenBvY21WbVBTSmtZWFJoT21sdFlXZGxMM04yWnl0NGJXdzdZbUZ6WlRZMExGQklUakphZVVJellWZFNNR0ZFTUc1TmFtdDNTbmxDYjFwWGJHNWhTRkU1U25wUmVVMURZMmRrYld4c1pEQktkbVZFTUc1TlEwRjNTVVJKTlUxRFFUQk5ha0Z1U1Vob2RHSkhOWHBRVTJSdlpFaFNkMDlwT0haa00yUXpURzVqZWt4dE9YbGFlVGg1VFVSQmQwd3pUakphZVdNclVFZE9jR050VG5OYVUwSnFaVVF3Yms1VWEyNUpSMDQxVUZOamVFMUVRVzVKU0VrNVNucEZkMDFJUWpSS2VVSnRZVmQ0YzFCVFkycFNhMXBGVWtSQmQwcDVPQ3RRUXpsNlpHMWpLeUlnTHo0OFptVkNiR1Z1WkNCdGIyUmxQU0p2ZG1WeWJHRjVJaUJwYmowaWNEQWlJR2x1TWowaWNERWlJQzgrUEdabFFteGxibVFnYlc5a1pUMGlaWGhqYkhWemFXOXVJaUJwYmpJOUluQXlJaUF2UGp4bVpVSnNaVzVrSUcxdlpHVTlJbTkyWlhKc1lYa2lJR2x1TWowaWNETWlJSEpsYzNWc2REMGlZbXhsYm1SUGRYUWlJQzgrUEdabFIyRjFjM05wWVc1Q2JIVnlJR2x1UFNKaWJHVnVaRTkxZENJZ2MzUmtSR1YyYVdGMGFXOXVQU0kwTWlJZ0x6NDhMMlpwYkhSbGNqNGdQR05zYVhCUVlYUm9JR2xrUFNKamIzSnVaWEp6SWo0OGNtVmpkQ0IzYVdSMGFEMGlNamt3SWlCb1pXbG5hSFE5SWpReU1DSWdjbmc5SWpReUlpQnllVDBpTkRJaUlDOCtQQzlqYkdsd1VHRjBhRDQ4Y0dGMGFDQnBaRDBpZEdWNGRDMXdZWFJvTFdFaUlHUTlJazAwTUNBeE1pQklNalV3SUVFeU9DQXlPQ0F3SURBZ01TQXlOemdnTkRBZ1ZqTTRNQ0JCTWpnZ01qZ2dNQ0F3SURFZ01qVXdJRFF3T0NCSU5EQWdRVEk0SURJNElEQWdNQ0F4SURFeUlETTRNQ0JXTkRBZ1FUSTRJREk0SURBZ01DQXhJRFF3SURFeUlIb2lJQzgrUEhCaGRHZ2dhV1E5SW0xcGJtbHRZWEFpSUdROUlrMHlNelFnTkRRMFF6SXpOQ0EwTlRjdU9UUTVJREkwTWk0eU1TQTBOak1nTWpVeklEUTJNeUlnTHo0OFptbHNkR1Z5SUdsa1BTSjBiM0F0Y21WbmFXOXVMV0pzZFhJaVBqeG1aVWRoZFhOemFXRnVRbXgxY2lCcGJqMGlVMjkxY21ObFIzSmhjR2hwWXlJZ2MzUmtSR1YyYVdGMGFXOXVQU0l5TkNJZ0x6NDhMMlpwYkhSbGNqNDhiR2x1WldGeVIzSmhaR2xsYm5RZ2FXUTlJbWR5WVdRdGRYQWlJSGd4UFNJeElpQjRNajBpTUNJZ2VURTlJakVpSUhreVBTSXdJajQ4YzNSdmNDQnZabVp6WlhROUlqQXVNQ0lnYzNSdmNDMWpiMnh2Y2owaWQyaHBkR1VpSUhOMGIzQXRiM0JoWTJsMGVUMGlNU0lnTHo0OGMzUnZjQ0J2Wm1aelpYUTlJaTQ1SWlCemRHOXdMV052Ykc5eVBTSjNhR2wwWlNJZ2MzUnZjQzF2Y0dGamFYUjVQU0l3SWlBdlBqd3ZiR2x1WldGeVIzSmhaR2xsYm5RK1BHeHBibVZoY2tkeVlXUnBaVzUwSUdsa1BTSm5jbUZrTFdSdmQyNGlJSGd4UFNJd0lpQjRNajBpTVNJZ2VURTlJakFpSUhreVBTSXhJajQ4YzNSdmNDQnZabVp6WlhROUlqQXVNQ0lnYzNSdmNDMWpiMnh2Y2owaWQyaHBkR1VpSUhOMGIzQXRiM0JoWTJsMGVUMGlNU0lnTHo0OGMzUnZjQ0J2Wm1aelpYUTlJakF1T1NJZ2MzUnZjQzFqYjJ4dmNqMGlkMmhwZEdVaUlITjBiM0F0YjNCaFkybDBlVDBpTUNJZ0x6NDhMMnhwYm1WaGNrZHlZV1JwWlc1MFBqeHRZWE5ySUdsa1BTSm1ZV1JsTFhWd0lpQnRZWE5yUTI5dWRHVnVkRlZ1YVhSelBTSnZZbXBsWTNSQ2IzVnVaR2x1WjBKdmVDSStQSEpsWTNRZ2QybGtkR2c5SWpFaUlHaGxhV2RvZEQwaU1TSWdabWxzYkQwaWRYSnNLQ05uY21Ga0xYVndLU0lnTHo0OEwyMWhjMnMrUEcxaGMyc2dhV1E5SW1aaFpHVXRaRzkzYmlJZ2JXRnphME52Ym5SbGJuUlZibWwwY3owaWIySnFaV04wUW05MWJtUnBibWRDYjNnaVBqeHlaV04wSUhkcFpIUm9QU0l4SWlCb1pXbG5hSFE5SWpFaUlHWnBiR3c5SW5WeWJDZ2paM0poWkMxa2IzZHVLU0lnTHo0OEwyMWhjMnMrUEcxaGMyc2dhV1E5SW01dmJtVWlJRzFoYzJ0RGIyNTBaVzUwVlc1cGRITTlJbTlpYW1WamRFSnZkVzVrYVc1blFtOTRJajQ4Y21WamRDQjNhV1IwYUQwaU1TSWdhR1ZwWjJoMFBTSXhJaUJtYVd4c1BTSjNhR2wwWlNJZ0x6NDhMMjFoYzJzK1BHeHBibVZoY2tkeVlXUnBaVzUwSUdsa1BTSm5jbUZrTFhONWJXSnZiQ0krUEhOMGIzQWdiMlptYzJWMFBTSXdMamNpSUhOMGIzQXRZMjlzYjNJOUluZG9hWFJsSWlCemRHOXdMVzl3WVdOcGRIazlJakVpSUM4K1BITjBiM0FnYjJabWMyVjBQU0l1T1RVaUlITjBiM0F0WTI5c2IzSTlJbmRvYVhSbElpQnpkRzl3TFc5d1lXTnBkSGs5SWpBaUlDOCtQQzlzYVc1bFlYSkhjbUZrYVdWdWRENDhiV0Z6YXlCcFpEMGlabUZrWlMxemVXMWliMndpSUcxaGMydERiMjUwWlc1MFZXNXBkSE05SW5WelpYSlRjR0ZqWlU5dVZYTmxJajQ4Y21WamRDQjNhV1IwYUQwaU1qa3djSGdpSUdobGFXZG9kRDBpTWpBd2NIZ2lJR1pwYkd3OUluVnliQ2dqWjNKaFpDMXplVzFpYjJ3cElpQXZQand2YldGemF6NDhMMlJsWm5NK1BHY2dZMnhwY0Mxd1lYUm9QU0oxY213b0kyTnZjbTVsY25NcElqNDhjbVZqZENCbWFXeHNQU0l3TURFME9Ea2lJSGc5SWpCd2VDSWdlVDBpTUhCNElpQjNhV1IwYUQwaU1qa3djSGdpSUdobGFXZG9kRDBpTkRJd2NIZ2lJQzgrUEhKbFkzUWdjM1I1YkdVOUltWnBiSFJsY2pvZ2RYSnNLQ05tTVNraUlIZzlJakJ3ZUNJZ2VUMGlNSEI0SWlCM2FXUjBhRDBpTWprd2NIZ2lJR2hsYVdkb2REMGlOREl3Y0hnaUlDOCtJRHhuSUhOMGVXeGxQU0ptYVd4MFpYSTZkWEpzS0NOMGIzQXRjbVZuYVc5dUxXSnNkWElwT3lCMGNtRnVjMlp2Y20wNmMyTmhiR1VvTVM0MUtUc2dkSEpoYm5ObWIzSnRMVzl5YVdkcGJqcGpaVzUwWlhJZ2RHOXdPeUkrUEhKbFkzUWdabWxzYkQwaWJtOXVaU0lnZUQwaU1IQjRJaUI1UFNJd2NIZ2lJSGRwWkhSb1BTSXlPVEJ3ZUNJZ2FHVnBaMmgwUFNJME1qQndlQ0lnTHo0OFpXeHNhWEJ6WlNCamVEMGlOVEFsSWlCamVUMGlNSEI0SWlCeWVEMGlNVGd3Y0hnaUlISjVQU0l4TWpCd2VDSWdabWxzYkQwaU1EQXhORGc1SWlCdmNHRmphWFI1UFNJd0lpQXZQand2Wno0OGNtVmpkQ0I0UFNJd0lpQjVQU0l3SWlCM2FXUjBhRDBpTWprd0lpQm9aV2xuYUhROUlqUXlNQ0lnY25nOUlqUXlJaUJ5ZVQwaU5ESWlJR1pwYkd3OUluSm5ZbUVvTUN3d0xEQXNNQ2tpSUhOMGNtOXJaVDBpY21kaVlTZ3lOVFVzTWpVMUxESTFOU3d3TGpJcElpQXZQand2Wno0OGRHVjRkQ0IwWlhoMExYSmxibVJsY21sdVp6MGliM0IwYVcxcGVtVlRjR1ZsWkNJK1BIUmxlSFJRWVhSb0lITjBZWEowVDJabWMyVjBQU0l0TVRBd0pTSWdabWxzYkQwaWQyaHBkR1VpSUdadmJuUXRabUZ0YVd4NVBTSW5RMjkxY21sbGNpQk9aWGNuTENCdGIyNXZjM0JoWTJVaUlHWnZiblF0YzJsNlpUMGlNVEJ3ZUNJZ2VHeHBibXM2YUhKbFpqMGlJM1JsZUhRdGNHRjBhQzFoSWo1SVlYTm9JT0tBb2lBd2VEQTNOREUzTWpobE0yRmhaVGN5WldSaE5EZzBaVGhqWTJKbU1EQm1PRFF6WXpNNFpXRmxPV016T1RsaU9XSmtOMlppTW1JMVpXVTNZVEExTldJMlltWWdQR0Z1YVcxaGRHVWdZV1JrYVhScGRtVTlJbk4xYlNJZ1lYUjBjbWxpZFhSbFRtRnRaVDBpYzNSaGNuUlBabVp6WlhRaUlHWnliMjA5SWpBbElpQjBiejBpTVRBd0pTSWdZbVZuYVc0OUlqQnpJaUJrZFhJOUlqTXdjeUlnY21Wd1pXRjBRMjkxYm5ROUltbHVaR1ZtYVc1cGRHVWlJQzgrUEM5MFpYaDBVR0YwYUQ0Z1BIUmxlSFJRWVhSb0lITjBZWEowVDJabWMyVjBQU0l3SlNJZ1ptbHNiRDBpZDJocGRHVWlJR1p2Ym5RdFptRnRhV3g1UFNJblEyOTFjbWxsY2lCT1pYY25MQ0J0YjI1dmMzQmhZMlVpSUdadmJuUXRjMmw2WlQwaU1UQndlQ0lnZUd4cGJtczZhSEpsWmowaUkzUmxlSFF0Y0dGMGFDMWhJajVJWVhOb0lPS0FvaUF3ZURBM05ERTNNamhsTTJGaFpUY3laV1JoTkRnMFpUaGpZMkptTURCbU9EUXpZek00WldGbE9XTXpPVGxpT1dKa04yWmlNbUkxWldVM1lUQTFOV0kyWW1ZZ1BHRnVhVzFoZEdVZ1lXUmthWFJwZG1VOUluTjFiU0lnWVhSMGNtbGlkWFJsVG1GdFpUMGljM1JoY25SUFptWnpaWFFpSUdaeWIyMDlJakFsSWlCMGJ6MGlNVEF3SlNJZ1ltVm5hVzQ5SWpCeklpQmtkWEk5SWpNd2N5SWdjbVZ3WldGMFEyOTFiblE5SW1sdVpHVm1hVzVwZEdVaUlDOCtJRHd2ZEdWNGRGQmhkR2crUEhSbGVIUlFZWFJvSUhOMFlYSjBUMlptYzJWMFBTSTFNQ1VpSUdacGJHdzlJbmRvYVhSbElpQm1iMjUwTFdaaGJXbHNlVDBpSjBOdmRYSnBaWElnVG1WM0p5d2diVzl1YjNOd1lXTmxJaUJtYjI1MExYTnBlbVU5SWpFd2NIZ2lJSGhzYVc1ck9taHlaV1k5SWlOMFpYaDBMWEJoZEdndFlTSStUM2R1WlhJZzRvQ2lJREI0TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01TQThZVzVwYldGMFpTQmhaR1JwZEdsMlpUMGljM1Z0SWlCaGRIUnlhV0oxZEdWT1lXMWxQU0p6ZEdGeWRFOW1abk5sZENJZ1puSnZiVDBpTUNVaUlIUnZQU0l4TURBbElpQmlaV2RwYmowaU1ITWlJR1IxY2owaU16QnpJaUJ5WlhCbFlYUkRiM1Z1ZEQwaWFXNWtaV1pwYm1sMFpTSWdMejQ4TDNSbGVIUlFZWFJvUGp4MFpYaDBVR0YwYUNCemRHRnlkRTltWm5ObGREMGlMVFV3SlNJZ1ptbHNiRDBpZDJocGRHVWlJR1p2Ym5RdFptRnRhV3g1UFNJblEyOTFjbWxsY2lCT1pYY25MQ0J0YjI1dmMzQmhZMlVpSUdadmJuUXRjMmw2WlQwaU1UQndlQ0lnZUd4cGJtczZhSEpsWmowaUkzUmxlSFF0Y0dGMGFDMWhJajVQZDI1bGNpRGlnS0lnTUhnd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXhJRHhoYm1sdFlYUmxJR0ZrWkdsMGFYWmxQU0p6ZFcwaUlHRjBkSEpwWW5WMFpVNWhiV1U5SW5OMFlYSjBUMlptYzJWMElpQm1jbTl0UFNJd0pTSWdkRzg5SWpFd01DVWlJR0psWjJsdVBTSXdjeUlnWkhWeVBTSXpNSE1pSUhKbGNHVmhkRU52ZFc1MFBTSnBibVJsWm1sdWFYUmxJaUF2UGp3dmRHVjRkRkJoZEdnK1BDOTBaWGgwUGp4bklITjBlV3hsUFNKMGNtRnVjMlp2Y20wNmRISmhibk5zWVhSbEtERXdOWEI0TENBM01IQjRLU0krUEhOMlp5QjNhV1IwYUQwaU9EVWlJR2hsYVdkb2REMGlPRFVpSUhacFpYZENiM2c5SWpBZ01DQXhPVElnTVRreUlpQm1hV3hzUFNKdWIyNWxJaUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lQanh3WVhSb0lHUTlJazB4TVRNdU56UTJJREV4T0M0ek9UWkRNVEUwTGpBMk55QXhNVGd1TXprMklERXlNeTQxTWpFZ01URTNMall4TmlBeE1qY3VNemMySURFeE5pNDVNamhETVRVeExqUTNNU0F4TVRFdU1UUTFJREUyT1M0ME1UWWdPRGt1TXpreE1pQXhOamt1TkRFMklEWXpMak0yT1RGRE1UWTVMalEyTWlBek1pNDVOREV5SURFME5DNDVNRGdnT0M0eU9UVTRPU0F4TVRRdU5qWTBJRGd1TWprMU9EbERNVEUwTGpNME1pQTRMakk1TlRnNUlERXhOQzR3TmpjZ09DNHlPVFU0T1NBeE1UTXVOelEySURndU1qazFPRGxJTVRFMExqWTJORWd4TVRZdU56STVRekV4TlM0ME9TQTRMakk1TlRnNUlERXhOQzR5T1RjZ09DNHlOU0F4TVRNdU1ERXhJRGd1TWpWSU5USXVOall3TkVNek5pNHlNekF6SURndU1qVWdNakl1T0RjMUlESXhMall3TlRNZ01qSXVPRGMxSURNNExqQXpOVFJXTVRVNExqSXpNME15TWk0NE56VWdNVGN5TGpNeU1pQXpOQzR6TURJM0lERTRNeTQzTlNBME9DNHpPVEl6SURFNE15NDNOVU0yTkM0ek5qTTFJREU0TXk0M05TQTNOeTR6TlRFMklERTNNQzQ0TURnZ056Y3VNelV4TmlBeE5UUXVOemt4VmpFeU15NHhOamxETnpjdU16VXhOaUF4TWpBdU5qUTFJRGM1TGpReE5qZ2dNVEU0TGpVNElEZ3hMamswTVNBeE1UZ3VOVGhJTVRBM0xqQTBOVU14TURrdU56VXpJREV4T0M0MU9DQXhNVE11TnpRMklERXhPQzR6TlRFZ01URXpMamMwTmlBeE1UZ3VNelV4VmpFeE9DNHpPVFphSWlCbWFXeHNQU0oxY213b0kzQmhhVzUwTUY5c2FXNWxZWEpmTWpVMFh6STJOemtwSWk4K1BIQmhkR2dnWkQwaVRUSXlMalVnTXpjdU56VTNPVXd5TXk0d01ETTRJREUwTmk0Mk1qVkRNekl1TXpBeE15QXhNVFV1TXpjMklEVXpMamN6TmlBeE1EY3VOVFF4SURnMkxqTTVNVGtnTVRFMUxqWXdOVU01TXk0eU5qSWdNVEUzTGpVM05TQTVPQzQyTWpBMklERXhPQzR5TVRjZ01UQXpMakk1TWlBeE1UZ3VORWd4TURZdU5EazRRekV3T1M0eU1ERWdNVEU0TGpRZ01URXpMakU0TlNBeE1UZ3VNVGN4SURFeE15NHhPRFVnTVRFNExqRTNNVU14TVRNdU5UQTJJREV4T0M0eE56RWdNVEl5TGprME1TQXhNVGN1TXpreUlERXlOaTQzT0RnZ01URTJMamN3TlVNeE16QXVOVFEwSURFeE5TNDNPRGdnTVRNMExqRTJNaUF4TVRRdU5EWWdNVE0zTGpVMU1TQXhNVEl1T0RGRE1UUTBMamM0T0NBeE1EZ3VPVFl4SURFMU1DNDJPVFlnTVRBekxqYzROQ0F4TlRRdU5EQTJJREV3TUM0ek1ERkRNVFU1TGpnMU5pQTVOQzR5T1RreElERTJOQzR3TWpRZ09EY3VNRFU1TnlBeE5qWXVOREEySURjNUxqQTROekZETVRZM0xqWTRPQ0EzTXk0NE5qTTJJREUyT0M0ek56VWdOamd1TVRNMk1pQXhOamd1TXpjMUlEWXhMamsxTURaRE1UWTRMak0zTlNBMU9TNDNOVEV5SURFMk9DNHlPRE1nTlRjdU5UazNOeUF4TmpndU1UUTJJRFUxTGpRNVF6RTJOQzQzTVRFZ016RXVNREl5TkNBeE5EVXVNek0zSURFeExqYzNPRElnTVRJd0xqZzRJRGd1TnpVME1UTkRNVEl3TGpBMU5TQTRMalkyTWpRNUlERXhPUzR5TXpFZ09DNDFOekE0TmlBeE1UZ3VNell4SURndU5USTFNRFJETVRFM0xqWTNOQ0E0TGpRM09USXlJREV4Tmk0NU9EY2dPQzQwTXpNMElERXhOaTR6SURndU5ETXpORU14TVRRdU5URXpJRGd1TXpReE56WWdNVEV5TGpZNE1TQTRMakkxTURFeUlERXhNQzQ0TURRZ09DNHlOVEF4TWtnMU1pNHlNalEyUXpNMUxqZzNNemdnT0M0eU1EUXpJREl5TGpVNU1UWWdNakV1TkRJd015QXlNaTQxSURNM0xqYzFOemxhSWlCbWFXeHNQU0oxY213b0kzQmhhVzUwTVY5c2FXNWxZWEpmTWpVMFh6STJOemtwSWk4K1BIQmhkR2dnWkQwaVRURXdOaTQyTmpjZ09Ua3VNell5T0VNeE1qQXVPREEwSURFd015NDBOVFVnTVRNeExqVTBNeUF4TURVdU1EQTNJREV6T1M0NE16a2dNVEExTGpBd04wTXhORFF1T0RZMElERXdOUzR3TURjZ01UUTRMams0T0NBeE1EUXVORE0ySURFMU1pNDBNak1nTVRBekxqVXhNME14TmpJdU9UTTRJRGt6TGpRMU56SWdNVFk1TGpVZ056a3VNall4TXlBeE5qa3VOU0EyTXk0MU1qTTNRekUyT1M0MU1EVWdNek11TURNd01TQXhORFF1T1RBeElEZ3VNekE0TmpnZ01URTBMalUxTnlBNExqTXdPRFk0UXpFeE5DNHlOVE1nT0M0ek1EZzJPQ0F4TVRNdU9UUTVJRGd1TXpFME1ESWdNVEV6TGpZME5TQTRMak14T1RNMVZqZ3VNekE0TmpoSU1URTJMalkxTkVNeE1UVXVORE15SURndU1qY3hNelFnTVRFMExqRTRPU0E0TGpJMUlERXhNaTQ1TXlBNExqSTFTRFV5TGpNM05EaERNelV1T0RjME15QTRMakkxSURJeUxqVWdNakV1TmpJME15QXlNaTQxSURNNExqRXlORGhXT1RrdU1UQXhORU0wTWk0MU16YzFJRGMyTGpNNE1EVWdOek11TmpnM015QTROeTQxTXpVMklERXdOaTQyTmpjZ09Ua3VNell5T0ZvaUlHWnBiR3c5SW5WeWJDZ2pjR0ZwYm5ReVgyeHBibVZoY2w4eU5UUmZNalkzT1NraUx6NDhjR0YwYUNCa1BTSk5NVEEyTGpRNE5TQTFNQzR5TlRJNVF6RXlNQzQxT0RJZ05UUXVNekkxTVNBeE16RXVNamd4SURVMUxqZzRNRGdnTVRNNUxqVTVNaUExTlM0NE9EQTRRekUxTkM0NU56UWdOVFV1T0Rnd09DQXhOakV1T1RBNElEVXdMalUzTXpJZ01UWTJMalVnTkRZdU1qSTJOVU14TlRrdU16TTNJREkwTGpJeE9EUWdNVE00TGpZM015QTRMakk1TlRjMUlERXhOQzR6TXpjZ09DNHlPVFUzTlVNeE1UUXVNREUxSURndU1qazFOelVnTVRFekxqYzBJRGd1TWprMU56VWdNVEV6TGpReE9DQTRMakk1TlRjMVNERXhOQzR6TXpkSU1URTJMalF3TTBNeE1UVXVNVFl6SURndU1qazFOelVnTVRFekxqazJPU0E0TGpJMUlERXhNaTQyT0RRZ09DNHlOVWcxTWk0ek1ERkRNelV1T0RZeU1pQTRMakkxSURJeUxqVWdNakV1TlRZME55QXlNaTQxSURNM0xqazBORGxXTlRBdU1ESTBNa00wTWk0ME56UTFJREkzTGpReU1UTWdOek11TlRZeE1pQXpPQzQxTXprM0lERXdOaTQwT0RVZ05UQXVNams0TjFZMU1DNHlOVEk1V2lJZ1ptbHNiRDBpZFhKc0tDTndZV2x1ZEROZmJHbHVaV0Z5WHpJMU5GOHlOamM1S1NJdlBqeHdZWFJvSUdROUlrMHhNRGN1TmpJeElESXhMalF6TXpSRE1USXhMalF5TnlBeU5TNDBOalUwSURFek1TNDVNRFVnTWpjdU1EQTFOeUF4TkRBdU1EUTFJREkzTGpBd05UZERNVFExTGpnd01pQXlOeTR3TURVM0lERTFNQzR5TlRRZ01qWXVNVGt3TXlBeE5UTXVPVFF5SURJMUxqQXhNalJETVRRMUxqWXlNaUF4Tmk0eU5qZzRJREV6TkM0MU1UUWdNVEF1TWpnNE55QXhNakV1T1RZM0lEZ3VOelE0TXpSRE1USXhMakUxTnlBNExqWTFOemN6SURFeU1DNHpORGdnT0M0MU5qY3hNeUF4TVRrdU5Ea3pJRGd1TlRJeE9ESkRNVEU0TGpneE9TQTRMalEzTmpVeUlERXhPQzR4TkRRZ09DNDBNekV5TVNBeE1UY3VORFk1SURndU5ETXhNakZETVRFMUxqY3hOaUE0TGpNME1EWXhJREV4TXk0NU1UY2dPQzR5TlNBeE1USXVNRGN6SURndU1qVklOVFF1TlRVek5VTTFNeTQzTkRRZ09DNHlOU0ExTWk0NU16UTFJRGd1TWprMU15QTFNaTR4TWpVZ09DNHpPRFU1TVVNMk9DNDFNems0SURjdU16ZzVNak1nT0RjdU56UXlPU0F4TkM0eU56VTBJREV3Tnk0Mk1qRWdNakV1TkRjNE4xWXlNUzQwTXpNMFdpSWdabWxzYkQwaWRYSnNLQ053WVdsdWREUmZiR2x1WldGeVh6STFORjh5TmpjNUtTSXZQanhrWldaelBqeHNhVzVsWVhKSGNtRmthV1Z1ZENCcFpEMGljR0ZwYm5Rd1gyeHBibVZoY2w4eU5UUmZNalkzT1NJZ2VERTlJakl5TGpnM05TSWdlVEU5SWpnMExqZzFNRGdpSUhneVBTSXhOamt1TkRFMklpQjVNajBpT0RRdU9EVXdPQ0lnWjNKaFpHbGxiblJWYm1sMGN6MGlkWE5sY2xOd1lXTmxUMjVWYzJVaVBqeHpkRzl3SUhOMGIzQXRZMjlzYjNJOUlpTTBNRFUzUTBJaUx6NDhjM1J2Y0NCdlptWnpaWFE5SWpBdU1UazJPVGNpSUhOMGIzQXRZMjlzYjNJOUlpTXpRek5CT1VZaUx6NDhjM1J2Y0NCdlptWnpaWFE5SWpBdU5UUTFORFUxSWlCemRHOXdMV052Ykc5eVBTSWpORFF4TlRjeElpOCtQSE4wYjNBZ2IyWm1jMlYwUFNJeElpQnpkRzl3TFdOdmJHOXlQU0lqTWpneFF6TkJJaTgrUEM5c2FXNWxZWEpIY21Ga2FXVnVkRDQ4YkdsdVpXRnlSM0poWkdsbGJuUWdhV1E5SW5CaGFXNTBNVjlzYVc1bFlYSmZNalUwWHpJMk56a2lJSGd4UFNJeU9DNHdNalUySWlCNU1UMGlOalF1TmpNMElpQjRNajBpTVRjekxqa3dNU0lnZVRJOUlqWTBMall6TkNJZ1ozSmhaR2xsYm5SVmJtbDBjejBpZFhObGNsTndZV05sVDI1VmMyVWlQanh6ZEc5d0lITjBiM0F0WTI5c2IzSTlJaU0zT0RGRE4wRWlMejQ4YzNSdmNDQnZabVp6WlhROUlqRWlJSE4wYjNBdFkyOXNiM0k5SWlNMU5URTJOekVpTHo0OEwyeHBibVZoY2tkeVlXUnBaVzUwUGp4c2FXNWxZWEpIY21Ga2FXVnVkQ0JwWkQwaWNHRnBiblF5WDJ4cGJtVmhjbDh5TlRSZk1qWTNPU0lnZURFOUlqSXlMalVpSUhreFBTSTJPUzR3TmpZMUlpQjRNajBpTVRZNUxqYzBJaUI1TWowaU5qa3VNRFkyTlNJZ1ozSmhaR2xsYm5SVmJtbDBjejBpZFhObGNsTndZV05sVDI1VmMyVWlQanh6ZEc5d0lHOW1abk5sZEQwaU1DNHhOVGswTWlJZ2MzUnZjQzFqYjJ4dmNqMGlJMFpGT0VFMk55SXZQanh6ZEc5d0lHOW1abk5sZEQwaU1TSWdjM1J2Y0MxamIyeHZjajBpSTBRNE1qVTFNQ0l2UGp3dmJHbHVaV0Z5UjNKaFpHbGxiblErUEd4cGJtVmhja2R5WVdScFpXNTBJR2xrUFNKd1lXbHVkRE5mYkdsdVpXRnlYekkxTkY4eU5qYzVJaUI0TVQwaU1qa3VNRFExTlNJZ2VURTlJakk0TGpNMU16TWlJSGd5UFNJeE5UY3VOemN6SWlCNU1qMGlNamd1TXpVek15SWdaM0poWkdsbGJuUlZibWwwY3owaWRYTmxjbE53WVdObFQyNVZjMlVpUGp4emRHOXdJSE4wYjNBdFkyOXNiM0k5SWlOR1EwUTBOVVlpTHo0OGMzUnZjQ0J2Wm1aelpYUTlJakVpSUhOMGIzQXRZMjlzYjNJOUlpTkdSamhFTmpZaUx6NDhMMnhwYm1WaGNrZHlZV1JwWlc1MFBqeHNhVzVsWVhKSGNtRmthV1Z1ZENCcFpEMGljR0ZwYm5RMFgyeHBibVZoY2w4eU5UUmZNalkzT1NJZ2VERTlJakV3TXk0d016TWlJSGt4UFNJNExqSTFJaUI0TWowaU1UZ3lMakEzTlNJZ2VUSTlJamd1TWpVaUlHZHlZV1JwWlc1MFZXNXBkSE05SW5WelpYSlRjR0ZqWlU5dVZYTmxJajQ4YzNSdmNDQnpkRzl3TFdOdmJHOXlQU0lqTmpSQ1FUUkRJaTgrUEhOMGIzQWdiMlptYzJWMFBTSXhJaUJ6ZEc5d0xXTnZiRzl5UFNJak1UZzJRVFEwSWk4K1BDOXNhVzVsWVhKSGNtRmthV1Z1ZEQ0OEwyUmxabk0rUEM5emRtYytQQzluUGlBOFp5QnpkSGxzWlQwaWRISmhibk5tYjNKdE9uUnlZVzV6YkdGMFpTZ3lPWEI0TENBek16UndlQ2tpUGp4eVpXTjBJSGRwWkhSb1BTSTJNM0I0SWlCb1pXbG5hSFE5SWpJMmNIZ2lJSEo0UFNJNGNIZ2lJSEo1UFNJNGNIZ2lJR1pwYkd3OUluSm5ZbUVvTUN3d0xEQXNNQzQyS1NJZ0x6NDhkR1Y0ZENCNFBTSXhNbkI0SWlCNVBTSXhOM0I0SWlCbWIyNTBMV1poYldsc2VUMGlKME52ZFhKcFpYSWdUbVYzSnl3Z2JXOXViM053WVdObElpQm1iMjUwTFhOcGVtVTlJakV5Y0hnaUlHWnBiR3c5SW5kb2FYUmxJajQ4ZEhOd1lXNGdabWxzYkQwaWNtZGlZU2d5TlRVc01qVTFMREkxTlN3d0xqWXBJajVKUkRvZ1BDOTBjM0JoYmo0eFBDOTBaWGgwUGp3dlp6NGdQR2NnYzNSNWJHVTlJblJ5WVc1elptOXliVHAwY21GdWMyeGhkR1VvTWpsd2VDd2dNelkwY0hncElqNDhjbVZqZENCM2FXUjBhRDBpTVRRM2NIZ2lJR2hsYVdkb2REMGlNalp3ZUNJZ2NuZzlJamh3ZUNJZ2NuazlJamh3ZUNJZ1ptbHNiRDBpY21kaVlTZ3dMREFzTUN3d0xqWXBJaUF2UGp4MFpYaDBJSGc5SWpFeWNIZ2lJSGs5SWpFM2NIZ2lJR1p2Ym5RdFptRnRhV3g1UFNJblEyOTFjbWxsY2lCT1pYY25MQ0J0YjI1dmMzQmhZMlVpSUdadmJuUXRjMmw2WlQwaU1USndlQ0lnWm1sc2JEMGlkMmhwZEdVaVBqeDBjM0JoYmlCbWFXeHNQU0p5WjJKaEtESTFOU3d5TlRVc01qVTFMREF1TmlraVBsQnNZWFJtYjNKdE9pQThMM1J6Y0dGdVBsSmxkbTlzZFhROEwzUmxlSFErUEM5blBqd3ZjM1puUGc9PSJ9";
        assertEq(tokenURI, expectedTokenURI);
    }

    function test_MintTwoSameIdHash() public {
        vm.startPrank(address(1));
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();

        // Register user 0x2 with same ID Hash
        accountRegistry.setAccountId(
            address(2),
            bytes32(0x0741728e3aae72eda484e8ccbf00f843c38eae9c399b9bd7fb2b5ee7a055b6bf)
        );
        vm.startPrank(address(2));
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();
        
        uint256 currTokenId = proofOfP2PNFTV3.currentTokenId();
        assertEq(currTokenId, 2);

        address ownerOne = proofOfP2PNFTV3.ownerOf(1);
        assertEq(ownerOne, address(1));

        uint256 balanceOne = proofOfP2PNFTV3.balanceOf(address(1));
        assertEq(balanceOne, 1);

        uint256 mintedOne = proofOfP2PNFTV3.getTokenId(address(1));
        assertEq(mintedOne, 1);

        address ownerTwo = proofOfP2PNFTV3.ownerOf(2);
        assertEq(ownerTwo, address(2));

        uint256 balanceTwo = proofOfP2PNFTV3.balanceOf(address(2));
        assertEq(balanceTwo, 1);

        uint256 mintedTwo = proofOfP2PNFTV3.getTokenId(address(2));
        assertEq(mintedTwo, 2);
    }

    function test_MintTwoDifferentIdHash() public {
        vm.startPrank(address(1));
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();

        // Register user 0x2
        accountRegistry.setAccountId(
            address(2),
            bytes32(uint256(2))
        );
        vm.startPrank(address(2));
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();
        
        uint256 currTokenId = proofOfP2PNFTV3.currentTokenId();
        assertEq(currTokenId, 2);

        address ownerOne = proofOfP2PNFTV3.ownerOf(1);
        assertEq(ownerOne, address(1));

        uint256 balanceOne = proofOfP2PNFTV3.balanceOf(address(1));
        assertEq(balanceOne, 1);

        uint256 mintedOne = proofOfP2PNFTV3.getTokenId(address(1));
        assertEq(mintedOne, 1);

        address ownerTwo = proofOfP2PNFTV3.ownerOf(2);
        assertEq(ownerTwo, address(2));

        uint256 balanceTwo = proofOfP2PNFTV3.balanceOf(address(2));
        assertEq(balanceTwo, 1);

        uint256 mintedTwo = proofOfP2PNFTV3.getTokenId(address(2));
        assertEq(mintedTwo, 2);
    }

    function test_RevertMintNotRegistered() public {
        vm.startPrank(address(0xd3ad));
        vm.expectRevert("Not registered");
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();
    }

    function test_RevertMintNullified() public {
        vm.startPrank(address(1));
        proofOfP2PNFTV3.mintSBT();
        vm.expectRevert("Already minted for owner");
        proofOfP2PNFTV3.mintSBT();
        vm.stopPrank();
    }

    function test_RevertTransfers() public {
        vm.startPrank(address(1));
        proofOfP2PNFTV3.mintSBT();
        
        vm.expectRevert("ERC721 public transferFrom not allowed");
        proofOfP2PNFTV3.transferFrom(address(1), address(2), 1);

        vm.expectRevert("ERC721 public safeTransferFrom not allowed");
        proofOfP2PNFTV3.safeTransferFrom(address(1), address(2), 1);

        vm.expectRevert("ERC721 public safeTransferFrom not allowed");
        proofOfP2PNFTV3.safeTransferFrom(address(1), address(2), 1, "");
        vm.stopPrank();
    }
}
